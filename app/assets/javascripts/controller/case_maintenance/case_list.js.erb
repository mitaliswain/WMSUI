wms.controller('CaseListCtrl', function ($scope, $http,  $location, $filter, $modal, UserService) {

    $scope.last_status = 'Created';
    $scope.lastitem = {};
    $scope.detail  = {}
    $scope.expand = 0
    $scope.squeeze = 100
    $scope.sortingOrder = sortingOrder;
    $scope.reverse = false;
    $scope.filteredItems = [];
    $scope.groupedItems = [];
    $scope.itemsPerPage = 8;
    $scope.pagedItems = [];
    $scope.currentPage = 0;

    $scope.case = 'new case';
   var url = '/case_maintenance.json?client=' + 'WM' + '&warehouse='+ 'WH1';


    var reload_modal_close =  function(){
        $scope.reload();
    }


    //Modal methods
    $scope.case_add_modal = function (size) {
        var modalInstance = $modal.open({
            templateUrl: '<%= asset_path('case_maintenance/add_header.html') %>',
            controller: 'caseAddCtrl',
            size: size,
            resolve: {
                case_header: function () {
                    return null;
                }
            }
        });
        modalInstance.result.then(reload_modal_close,reload_modal_close);
    };

    $scope.case_edit_modal = function (size, case_header) {
        var modalInstance = $modal.open({
            templateUrl: '<%= asset_path('case_maintenance/show_header.html') %>',
            controller: 'caseEditCtrl',
            size: size,
            resolve: {
                case_header: function () {
                    return case_header;
                },
                case_detail_id: function () {
                    return null;
                }
            }
        });

        modalInstance.result.then(reload_modal_close,reload_modal_close);
    };


    $scope.case_detail_add_modal = function (size, case_header) {
        var modalInstance = $modal.open({
            templateUrl: '<%= asset_path('case_maintenance/add_detail.html') %>',
            controller: 'caseAddCtrl',
            size: size,
            resolve: {
                case_header: function () {
                    return case_header;
                },
                case_detail_id: function () {
                    return null;
                }
            }
        });

        modalInstance.result.then(reload_modal_close,reload_modal_close);
    };

    $scope.case_detail_edit_modal = function (size, case_header, case_detail_id) {
        var modalInstance = $modal.open({
            templateUrl: '<%= asset_path('case_maintenance/show_detail.html') %>',
            controller: 'caseEditCtrl',
            size: size,
            resolve: {
                case_header: function () {
                    return case_header;
                },
                case_detail_id: function () {
                    return case_detail_id;
                }
            }
        });
        modalInstance.result.then(reload_modal_close,reload_modal_close);
    };

    $scope.reload = function() {

        $http.get(url).success(function(data) {
            $scope.items = data;

            UserService.set_page($scope);
            $scope.filter_option = "case_header"
            $scope.status(null);
            //groupToPages();

        });

    };

    $scope.reload();
});

