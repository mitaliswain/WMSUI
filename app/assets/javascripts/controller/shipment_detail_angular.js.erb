app.controller('shipmentCtrl', function ($scope, $http, $location) {	
  var warehouse = $location.search().warehouse;
  var shipment  =  $location.search().shipment;
  var client    = $location.search().client; 
  var url = '/shipment/'+  shipment + '.json?client=' + client + '&warehouse='+ warehouse;	
  $http.get(url).success(function(data) {
    $scope.shipment_header = data.shipment_header;
    $scope.shipment_details = data.shipment_detail;    
  });
  
  $scope.header_template = {
        name: 'header_template',
        url: '<%= asset_path("shipment_header.html") %>'
        }; 

  $scope.detail_template = {
        name: 'detail_template',
        url: '<%= asset_path("shipment_detail.html") %>'
        }; 


 $scope.updateHeader = function(data, el, id) {

    var warehouse = $location.search().warehouse;
    var shipment  =  $location.search().shipment;
    var client    = $location.search().client; 
    var fields_to_update = {};
    var url = '/shipment_details/'+ id + '/update_header?client=' + client + '&warehouse='+ warehouse;	
	fields_to_update[el.$editable.elem[0].id] = data;
    return $http.post(url, {
    	'authenticity_token': $('meta[name="csrf-token"]').attr('content'),
    	app_parameters: {'client': 'WM', 'warehouse': 'WH1','channel': '', 'building': ''},
    	fields_to_update: fields_to_update
    	});
 };
  
 $scope.updateDetail = function(data, el, id) {

    var warehouse = $location.search().warehouse;
    var shipment  =  $location.search().shipment;
    var client    = $location.search().client; 
    var fields_to_update = {};
    fields_to_update[el.$editable.elem[0].id] = data;
    var url = '/shipment_details/'+ id + '/update_detail?client=' + client + '&warehouse='+ warehouse;	
    return $http.post(url, {
    	'authenticity_token': $('meta[name="csrf-token"]').attr('content'),
    	shipment: {'client': 'WM', 'warehouse': 'WH1'},
    	fields_to_update: fields_to_update
    	});

 };
  

});