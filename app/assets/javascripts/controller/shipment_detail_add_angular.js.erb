app.controller('shipmentAddCtrl', function ($scope, $http, $location) {	
 
  var warehouse = $location.search().warehouse;
  var shipment  =  $location.search().shipment;
  var client    = $location.search().client; 
  //var url = '/shipment/'+  shipment + '.json?client=' + client + '&warehouse='+ warehouse;	
   $scope.shipment_header = {};
   $scope.shipment_details = {};    
  $scope.header_template = {
        name: 'header_template',
        url: '<%= asset_path("shipment_header.html") %>'
        }; 

  $scope.detail_template = {
        name: 'detail_template',
        url: '<%= asset_path("shipment_detail.html") %>'
        }; 
  
 $scope.saveHeader = function() {

    var warehouse = $location.search().warehouse;
    var shipment  =  $location.search().shipment;
    var client    = $location.search().client; 

    var fields_to_update = {};
    fields_to_update = $scope.shipment_header;
    var url = '/shipment/add_header?client=' + client + '&warehouse='+ warehouse;	
    return $http.post(url, {
    	'authenticity_token': $('meta[name="csrf-token"]').attr('content'),
    	app_parameters: {'client': 'WM', 'warehouse': 'WH1'},
    	fields_to_update: fields_to_update
    }).success(function(message){
    	if (message.status == false && message.message == 'field')
    	{ 
    		angular.forEach(message.message, function(error, field){
    			$scope.editableForm.$setError(field, error);
    		});
    	}
    		
    	if (message.status == false && message.message == 'error')
    	{ 
    		$scope.global_error = message.message[0].error;
    	}	   	
    }).error(function(message){
    	alert(message.message[0].error);	
    	$scope.global_error = message.message[0].error;
    });
 };


});


